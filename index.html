<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>animations</title>
    <style>
      * {
        box-sizing: border-box;
      }
      .parent {
        background-color: aqua;
        height: 12.5rem;
        width: 25rem;
      }
      .parent:hover {
        cursor: pointer;
      }
      .child {
        background-color: antiquewhite;
        height: 100%;
        width: 50%;
        border-radius: 50%;
      }

      .left-to-right {
        animation: left-to-right 0.5s ease-in forwards;
      }
      .right-to-left {
        animation: right-to-left 0.5s ease-in forwards;
      }
      .left-to-centre {
        animation: left-to-centre 0.4s ease-in forwards;
      }
      .right-to-centre {
        animation: right-to-centre 0.4s ease-in forwards;
      }
      .centre-to-left {
        animation: centre-to-left 0.4s ease-in forwards;
      }
      .centre-to-right {
        animation: centre-to-right 0.4s ease-in forwards;
      }
      @keyframes left-to-right {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(100%);
        }
      }
      @keyframes right-to-left {
        0% {
          transform: translateX(100%);
        }
        100% {
          transform: translateX(0);
        }
      }
      @keyframes left-to-centre {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(50%);
        }
      }
      @keyframes right-to-centre {
        0% {
          transform: translateX(100%);
        }
        100% {
          transform: translateX(50%);
        }
      }
      @keyframes centre-to-left {
        0% {
          transform: translateX(50%);
        }
        100% {
          transform: translateX(0%);
        }
      }
      @keyframes centre-to-right {
        0% {
          transform: translateX(50%);
        }
        100% {
          transform: translateX(100%);
        }
      }
    </style>
  </head>
  <body>
    <div class="parent" id="parent">
      <div class="child" id="child"></div>
    </div>
    <script>
      let position = 0; //0: left, 1: centre, 2: right
      let wantsToMoveTo = 0;
      isAnimating = false;
      const el = document.getElementById('child');
      const parent = document.getElementById('parent');

      //   el.addEventListener('webkitAnimationEnd', () => {
      //     console.log('animation end');
      //     isAnimating = false;
      //   });

      el.addEventListener('animationend', () => {
        isAnimating = false;
      });

      parent.addEventListener('click', (event) => {
        if (isAnimating) return;
        let target = event.target;
        if (event.target.id === 'child') {
          target = event.target.parentNode;
        } //makes sure the event is considered on the parent

        const bcr = target.getBoundingClientRect();

        const relXClickPercent =
          (event.clientX / (bcr.right - bcr.left)) * 100 - 1;

        console.log(relXClickPercent);

        wantsToMoveTo = Math.floor(relXClickPercent / 33.33333333);
        if (wantsToMoveTo > 2) {
          wantsToMoveTo = 2;
        }

        if (wantsToMoveTo === position) return;

        isAnimating = true;

        //remove all keyframe classes
        el.classList.remove('left-to-right');
        el.classList.remove('right-to-left');
        el.classList.remove('right-to-centre');
        el.classList.remove('left-to-centre');
        el.classList.remove('centre-to-right');
        el.classList.remove('centre-to-left');

        if (position === 0 && wantsToMoveTo === 1) {
          el.classList.add('left-to-centre');
          position = 1;
        } else if (position === 1 && wantsToMoveTo === 2) {
          el.classList.add('centre-to-right');
          position = 2;
        } else if (position === 0 && wantsToMoveTo === 2) {
          el.classList.add('left-to-right');
          position = 2;
        } else if (position === 2 && wantsToMoveTo === 1) {
          el.classList.add('right-to-centre');
          position = 1;
        } else if (position === 2 && wantsToMoveTo === 0) {
          el.classList.add('right-to-left');
          position = 0;
        } else if (position === 1 && wantsToMoveTo === 0) {
          el.classList.add('centre-to-left');
          position = 0;
        }
      });
    </script>
  </body>
</html>
