<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>animations</title>
    <style>
      .parent {
        background-color: aqua;
        height: 25rem;
        width: 25rem;
      }
      .child {
        background-color: antiquewhite;
        height: 50%;
        width: 50%;
      }

      .left-to-right {
        animation: left-to-right 1s ease-in forwards;
      }
      .right-to-left {
        animation: right-to-left 1s ease-in forwards;
      }
      .left-to-centre {
        animation: left-to-centre 1s ease-in forwards;
      }
      .right-to-centre {
        animation: right-to-centre 1s ease-in forwards;
      }
      .centre-to-left {
        animation: centre-to-left 1s ease-in forwards;
      }
      .centre-to-right {
        animation: centre-to-right 1s ease-in forwards;
      }
      @keyframes left-to-right {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(100%);
        }
      }
      @keyframes right-to-left {
        0% {
          transform: translateX(100%);
        }
        100% {
          transform: translateX(0);
        }
      }
      @keyframes left-to-centre {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(50%);
        }
      }
      @keyframes right-to-centre {
        0% {
          transform: translateX(100%);
        }
        100% {
          transform: translateX(50%);
        }
      }
      @keyframes centre-to-left {
        0% {
          transform: translateX(50%);
        }
        100% {
          transform: translateX(0%);
        }
      }
      @keyframes centre-to-right {
        0% {
          transform: translateX(50%);
        }
        100% {
          transform: translateX(100%);
        }
      }
    </style>
  </head>
  <body>
    <div class="parent" id="parent">
      <div class="child" id="child"></div>
    </div>
    <button id="full-left">full left</button>
    <button id="full-right">full right</button>
    <button id="half-left">half left</button>
    <button id="half-right">half right</button>
    <script>
      let position = 0; //0: left, 1: centre, 2: right
      let wantsToMoveTo = 0;
      isAnimating = false;
      const el = document.getElementById('child');
      const parent = document.getElementById('parent');

      el.addEventListener('webkitAnimationEnd', () => {
        console.log('animation end');
        isAnimating = false;
      });

      el.addEventListener('animationend', () => {
        console.log('standard animation end');
        isAnimating = false;
      });

      //   buttonListeners();

      parent.addEventListener('click', (event) => {
        console.log(isAnimating);
        if (isAnimating) return;
        let target = event.target;
        if (event.target.id === 'child') {
          target = event.target.parentNode;
        } //makes sure the event is considered on the parent

        const bcr = target.getBoundingClientRect();
        console.log(bcr.left, event.clientX, bcr.right);
        const relXClickPercent =
          (event.clientX / (bcr.right - bcr.left)) * 100 - 1;
        console.log('percent rel x', relXClickPercent);

        const wantsToMoveTo = Math.floor(relXClickPercent / 33.33333);

        if (wantsToMoveTo === position) return;

        isAnimating = true;
        console.log('begin to animate');

        //remove all keyframe classes
        el.classList.remove('left-to-right');
        el.classList.remove('right-to-left');
        el.classList.remove('right-to-centre');
        el.classList.remove('left-to-centre');
        el.classList.remove('centre-to-right');
        el.classList.remove('centre-to-left');

        if (position === 0 && wantsToMoveTo === 1) {
          el.classList.add('left-to-centre');
          position = 1;
        } else if (position === 1 && wantsToMoveTo === 2) {
          el.classList.add('centre-to-right');
          position = 2;
        } else if (position === 0 && wantsToMoveTo === 2) {
          el.classList.add('left-to-right');
          position = 2;
        } else if (position === 2 && wantsToMoveTo === 1) {
          el.classList.add('right-to-centre');
          position = 1;
        } else if (position === 2 && wantsToMoveTo === 0) {
          el.classList.add('right-to-left');
          position = 0;
        } else if (position === 1 && wantsToMoveTo === 0) {
          el.classList.add('centre-to-left');
          position = 0;
        }
      });

      //-------------------------------------------------------------//

      function buttonListeners() {
        document.addEventListener(
          'click',
          function (event) {
            //remove all animation classes
            el.classList.remove('left-to-right');
            el.classList.remove('right-to-left');
            el.classList.remove('right-to-centre');
            el.classList.remove('left-to-centre');
            el.classList.remove('centre-to-right');
            el.classList.remove('centre-to-left');

            if (event.target.id === 'full-right') {
              if (position === 0) {
                el.classList.add('left-to-right');
              } else if (position === 1) {
                el.classList.add('centre-to-right');
              }
              position = 2;
            } else if (event.target.id === 'full-left') {
              if (position === 2) {
                el.classList.add('right-to-left');
              } else if (position === 1) {
                el.classList.add('centre-to-left');
              }
              position = 0;
            } else if (event.target.id === 'half-left') {
              if (position === 2) {
                el.classList.add('right-to-centre');
                position = 1;
              } else if (position === 1) {
                el.classList.add('centre-to-left');
                position = 0;
              }
            } else if (event.target.id === 'half-right') {
              if (position === 0) {
                el.classList.add('left-to-centre');
                position = 1;
              } else if (position === 1) {
                el.classList.add('centre-to-right');
                position = 2;
              }
            }
          },
          false
        );
      }
    </script>
  </body>
</html>
